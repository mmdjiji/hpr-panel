<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPR è°ƒè¯•å·¥å…·</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .container { max-width: 800px; margin: 0 auto; }
        .section { 
            background: white; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .warning { color: #e6a23c; }
        pre { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            font-size: 12px;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #66b1ff; }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #67c23a; }
        .status-error { background: #f56c6c; }
        .status-warning { background: #e6a23c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ HPR ç®¡ç†é¢æ¿è°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h2>ğŸ” è®¤è¯çŠ¶æ€</h2>
            <div id="auth-status">æ£€æŸ¥ä¸­...</div>
            <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
            <button onclick="clearAuth()">æ¸…é™¤è®¤è¯</button>
        </div>
        
        <div class="section">
            <h2>ğŸ”— API è¿æ¥æµ‹è¯•</h2>
            <div id="api-status">æµ‹è¯•ä¸­...</div>
            <button onclick="testAPI()">é‡æ–°æµ‹è¯•API</button>
        </div>
        
        <div class="section">
            <h2>ğŸ“ è·¯ç”±çŠ¶æ€</h2>
            <div id="route-status">æ£€æŸ¥ä¸­...</div>
            <button onclick="navigateTo('/dashboard')">è·³è½¬åˆ°Dashboard</button>
            <button onclick="navigateTo('/login')">è·³è½¬åˆ°ç™»å½•</button>
        </div>
        
        <div class="section">
            <h2>ğŸ¨ æ ·å¼æ£€æŸ¥</h2>
            <div id="style-status">æ£€æŸ¥ä¸­...</div>
        </div>
        
        <div class="section">
            <h2>ğŸ“± å¿«é€Ÿæ“ä½œ</h2>
            <button onclick="quickLogin()">å¿«é€Ÿç™»å½• (hpr/p@ssw0rd)</button>
            <button onclick="showLocalStorage()">æŸ¥çœ‹ localStorage</button>
            <button onclick="clearAll()">æ¸…ç†æ‰€æœ‰æ•°æ®</button>
        </div>
    </div>

    <script>
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuth() {
            const authDiv = document.getElementById('auth-status');
            const credentials = localStorage.getItem('hpr-credentials');
            
            if (credentials) {
                try {
                    const creds = JSON.parse(credentials);
                    authDiv.innerHTML = `
                        <div><span class="status-indicator status-success"></span><span class="success">âœ“ å·²ç™»å½•</span></div>
                        <div>ç”¨æˆ·å: <strong>${creds.username}</strong></div>
                        <div>å¯†ç : <strong>${creds.password.replace(/./g, '*')}</strong></div>
                    `;
                } catch (e) {
                    authDiv.innerHTML = `<div><span class="status-indicator status-error"></span><span class="error">âœ— è®¤è¯æ•°æ®æŸå: ${e.message}</span></div>`;
                }
            } else {
                authDiv.innerHTML = `<div><span class="status-indicator status-error"></span><span class="error">âœ— æœªç™»å½•</span></div>`;
            }
        }
        
        // æµ‹è¯•APIè¿æ¥
        async function testAPI() {
            const apiDiv = document.getElementById('api-status');
            apiDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const credentials = localStorage.getItem('hpr-credentials');
                const headers = { 'Accept': 'application/json' };
                
                if (credentials) {
                    const { username, password } = JSON.parse(credentials);
                    if (username && password && username !== 'anonymous') {
                        headers['Authorization'] = `Basic ${btoa(username + ':' + password)}`;
                    }
                }
                
                const response = await fetch('/api/info', { headers });
                
                if (response.ok) {
                    const data = await response.json();
                    apiDiv.innerHTML = `
                        <div><span class="status-indicator status-success"></span><span class="success">âœ“ APIè¿æ¥æ­£å¸¸</span></div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    apiDiv.innerHTML = `
                        <div><span class="status-indicator status-error"></span><span class="error">âœ— APIè¿æ¥å¤±è´¥</span></div>
                        <div>çŠ¶æ€ç : ${response.status}</div>
                        <div>çŠ¶æ€æ–‡æœ¬: ${response.statusText}</div>
                    `;
                }
            } catch (error) {
                apiDiv.innerHTML = `
                    <div><span class="status-indicator status-error"></span><span class="error">âœ— APIè¿æ¥é”™è¯¯</span></div>
                    <div>é”™è¯¯: ${error.message}</div>
                `;
            }
        }
        
        // æ£€æŸ¥è·¯ç”±çŠ¶æ€
        function checkRoute() {
            const routeDiv = document.getElementById('route-status');
            routeDiv.innerHTML = `
                <div>å½“å‰è·¯å¾„: <strong>${window.location.pathname}</strong></div>
                <div>å®Œæ•´URL: <strong>${window.location.href}</strong></div>
                <div>Hash: <strong>${window.location.hash || 'æ— '}</strong></div>
            `;
        }
        
        // æ£€æŸ¥æ ·å¼
        function checkStyle() {
            const styleDiv = document.getElementById('style-status');
            
            // æ£€æŸ¥Element Plusæ˜¯å¦åŠ è½½
            const elButton = document.createElement('div');
            elButton.className = 'el-button';
            document.body.appendChild(elButton);
            
            const styles = window.getComputedStyle(elButton);
            const hasElementPlus = styles.display !== 'block' || styles.position !== 'static';
            
            document.body.removeChild(elButton);
            
            styleDiv.innerHTML = `
                <div><span class="status-indicator ${hasElementPlus ? 'status-success' : 'status-error'}"></span>
                Element Plus æ ·å¼: ${hasElementPlus ? 'âœ“ å·²åŠ è½½' : 'âœ— æœªåŠ è½½'}</div>
            `;
        }
        
        // å¿«é€Ÿç™»å½•
        function quickLogin() {
            localStorage.setItem('hpr-credentials', JSON.stringify({
                username: 'hpr',
                password: 'p@ssw0rd'
            }));
            alert('å·²è®¾ç½®ç™»å½•å‡­æ®ï¼Œè¯·åˆ·æ–°é¡µé¢');
            checkAuth();
        }
        
        // æµ‹è¯•ç™»å½•æµç¨‹
        async function testLogin() {
            try {
                const credentials = { username: 'hpr', password: 'p@ssw0rd' };
                localStorage.setItem('hpr-credentials', JSON.stringify(credentials));
                
                const response = await fetch('/api/info', {
                    headers: {
                        'Authorization': `Basic ${btoa(credentials.username + ':' + credentials.password)}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    alert('ç™»å½•æµ‹è¯•æˆåŠŸï¼');
                    checkAuth();
                    testAPI();
                } else {
                    alert(`ç™»å½•æµ‹è¯•å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                alert(`ç™»å½•æµ‹è¯•é”™è¯¯: ${error.message}`);
            }
        }
        
        // æ¸…é™¤è®¤è¯
        function clearAuth() {
            localStorage.removeItem('hpr-credentials');
            alert('å·²æ¸…é™¤è®¤è¯ä¿¡æ¯');
            checkAuth();
        }
        
        // æ˜¾ç¤ºlocalStorage
        function showLocalStorage() {
            const items = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                items.push(`${key}: ${localStorage.getItem(key)}`);
            }
            alert('localStorage å†…å®¹:\n' + (items.length ? items.join('\n') : '(ç©º)'));
        }
        
        // æ¸…ç†æ‰€æœ‰æ•°æ®
        function clearAll() {
            localStorage.clear();
            alert('å·²æ¸…ç†æ‰€æœ‰æ•°æ®');
            window.location.reload();
        }
        
        // å¯¼èˆª
        function navigateTo(path) {
            window.location.href = path;
        }
        
        // åˆå§‹åŒ–
        checkAuth();
        testAPI();
        checkRoute();
        checkStyle();
    </script>
</body>
</html>
